<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katakana & Hiragana Romaji Quiz</title>

    <!-- Favicon -->
    <link rel="icon" href="image (14).jpg" type="image/jpeg">

    <!-- SEO Meta Tags -->
    <meta name="description" content="An interactive quiz to learn and practice Hiragana and Katakana, with charts for reference.">
    <meta name="keywords" content="Hiragana, Katakana, Romaji, Japanese, language, quiz, learn, practice, chart">
    <meta name="author" content="AI Assistant">
    <link rel="canonical" href="https://hiragana-katakana-quiz.netlify.app"> <!-- Replace with your actual URL -->

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://hiragana-katakana-quiz.netlify.app"> <!-- Replace with your actual URL -->
    <meta property="og:title" content="Katakana & Hiragana Romaji Quiz">
    <meta property="og:description" content="An interactive quiz to learn and practice Hiragana and Katakana, with charts for reference.">
    <meta property="og:image" content="https://placehold.co/1200x630/cccccc/ffffff?text=Kana+Quiz"> <!-- Replace with a relevant image -->

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://hiragana-katakana-quiz.netlify.app"> <!-- Replace with your actual URL -->
    <meta property="twitter:title" content="Katakana & Hiragana Romaji Quiz">
    <meta property="twitter:description" content="An interactive quiz to learn and practice Hiragana and Katakana, with charts for reference.">
    <meta property="twitter:image" content="https://placehold.co/1200x630/cccccc/ffffff?text=Kana+Quiz"> <!-- Replace with a relevant image -->
    <!-- End SEO Meta Tags -->

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom CSS for screen shake animation */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        .shake-screen {
            animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        /* Ensure smooth font rendering for Japanese characters */
        body {
            font-family: 'Inter', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Message box styling */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4CAF50; /* Green for success */
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            z-index: 1000;
        }

        .message-box.show {
            opacity: 1;
            visibility: visible;
        }

        .message-box.error {
            background-color: #f44336; /* Red for error */
        }

        /* Chart Modal Styles */
        .chart-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black background */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20; /* Above other content */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .chart-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .chart-modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); /* shadow-2xl */
            position: relative;
            max-width: 95%; /* Increased max-width for better chart display */
            max-height: 90vh; /* Limit height for scrollability */
            overflow-y: auto; /* Enable scrolling for large charts */
            transform: scale(0.95); /* Initial smaller scale for animation */
            transition: transform 0.3s ease-in-out;
        }

        .chart-modal-overlay.show .chart-modal-content {
            transform: scale(1); /* Scale to normal when shown */
        }

        /* Custom scrollbar hiding for webkit browsers */
        .chart-modal-content::-webkit-scrollbar {
            width: 0px;  /* Remove scrollbar space */
            background: transparent;  /* Optional: just make scrollbar invisible */
        }
        .chart-modal-content::-webkit-scrollbar-thumb {
            background: transparent; /* Optional: hide the thumb */
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(5, minmax(0, 1fr)); /* 5 columns for 'a', 'i', 'u', 'e', 'o' */
            gap: 0.75rem; /* Slightly reduced gap for more cells */
        }

        .chart-cell {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem; /* Reduced padding */
            border-radius: 0.375rem; /* rounded-md */
            background-color: #f9fafb; /* bg-gray-50 */
            border: 1px solid #e5e7eb; /* border-gray-200 */
        }

        .chart-kana {
            font-size: 2rem; /* Adjusted font size for better fit */
            font-weight: bold;
            color: #1f2937; /* text-gray-800 */
        }

        .chart-romaji {
            font-size: 0.75rem; /* text-xs */
            color: #6b7280; /* text-gray-500 */
            margin-top: 0.1rem; /* Reduced margin */
            /* Add this to hide/show Romaji */
            visibility: visible;
            opacity: 1;
            transition: opacity 0.2s ease-in-out;
        }

        .chart-romaji.hidden {
            visibility: hidden;
            opacity: 0;
            height: 0; /* Collapse space when hidden */
            margin-top: 0;
        }


        /* Empty cells in the chart */
        .chart-cell.empty {
            background-color: transparent;
            border: none;
        }

        /* Close button for modal */
        .modal-close-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            line-height: 1;
            color: #6b7280; /* text-gray-500 */
            cursor: pointer;
            transition: color 0.2s ease-in-out;
            z-index: 10; /* Ensure it's above chart content */
        }
        .modal-close-button:hover {
            color: #374151; /* text-gray-700 */
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">

    <!-- Quiz Type Selection Checkboxes -->
    <div class="bg-white p-6 rounded-xl shadow-lg mb-8 w-full max-w-md">
        <h2 class="text-xl font-semibold mb-4 text-gray-800">Choose Quiz Type:</h2>
        <div class="flex items-center space-x-6 justify-center">
            <label for="quiz-hiragana" class="flex items-center cursor-pointer text-gray-700">
                <input type="checkbox" id="quiz-hiragana" class="form-checkbox h-5 w-5 text-green-600 rounded-md" checked>
                <span class="ml-2 text-lg">Hiragana</span>
            </label>
            <label for="quiz-katakana" class="flex items-center cursor-pointer text-gray-700">
                <input type="checkbox" id="quiz-katakana" class="form-checkbox h-5 w-5 text-green-600 rounded-md" checked>
                <span class="ml-2 text-lg">Katakana</span>
            </label>
        </div>
    </div>

    <div id="quiz-container" class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md text-center mb-8">
        <h1 class="text-3xl font-bold mb-6 text-gray-800">Katakana & Hiragana Quiz</h1>

        <!-- Display area for Japanese characters -->
        <div id="kana-display" class="flex justify-center items-center space-x-6 mb-8">
            <!-- Each character will be rendered here dynamically -->
        </div>

        <!-- Romaji input field -->
        <input
            type="text"
            id="romaji-input"
            class="w-full px-4 py-3 mb-6 border-2 border-gray-300 rounded-lg text-lg text-gray-700 placeholder-gray-400 focus:outline-none transition duration-200"
            placeholder="Type Romaji here..."
            autofocus
        />

        <!-- Buttons container -->
        <div class="flex flex-col space-y-4">
            <!-- Check Answer button -->
            <button
                id="check-button"
                class="bg-gradient-to-br from-green-400 to-green-600 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transition duration-300 ease-in-out transform hover:scale-105 w-full border border-green-500 focus:outline-none"
            >
                Check Answer
            </button>

            <!-- Show Answer button -->
            <button
                id="show-answer-button"
                class="bg-gradient-to-br from-lime-300/80 to-lime-500/80 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition duration-300 ease-in-out transform hover:scale-105 w-full border border-lime-400/80 focus:outline-none"
            >
                Show Answer
            </button>
        </div>

        <!-- Display area for correct answers -->
        <div id="answer-display" class="mt-6 text-lg font-semibold text-gray-700">
            <!-- Correct answers will be displayed here -->
        </div>

        <!-- Message box for feedback -->
        <div id="message-box" class="message-box"></div>
    </div>

    <!-- Chart Buttons outside the quiz box -->
    <div class="flex space-x-4 mt-8">
        <button
            id="show-hiragana-chart-button"
            class="bg-gradient-to-br from-teal-400/80 to-teal-600/80 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition duration-300 ease-in-out transform hover:scale-105 border border-teal-500/80 focus:outline-none"
        >
            Show Hiragana Chart
        </button>
        <button
            id="show-katakana-chart-button"
            class="bg-gradient-to-br from-indigo-400/80 to-indigo-600/80 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition duration-300 ease-in-out transform hover:scale-105 border border-indigo-500/80 focus:outline-none"
        >
            Show Katakana Chart
        </button>
    </div>

    <!-- Chart Modal Structure -->
    <div id="chart-modal-overlay" class="chart-modal-overlay">
        <div id="chart-modal-content" class="chart-modal-content">
            <button id="close-chart-modal-button" class="modal-close-button">&times;</button>
            <h2 id="chart-title" class="text-2xl font-bold mb-4 text-gray-800"></h2>

            <!-- Checkbox for toggling Romaji in chart -->
            <div class="flex items-center justify-end mb-4">
                <label for="show-romaji-chart" class="flex items-center cursor-pointer text-gray-700">
                    <input type="checkbox" id="show-romaji-chart" class="form-checkbox h-4 w-4 text-blue-600 rounded-sm" checked>
                    <span class="ml-2 text-sm">Show Romaji</span>
                </label>
            </div>

            <div id="chart-grid" class="chart-grid">
                <!-- Chart content will be dynamically loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Full kana data including hiragana and katakana for Gojūon chart layout
        // Each object has kana, romaji, and type.
        const fullKanaData = [
            // Hiragana
            { kana: "あ", romaji: "a", type: "hiragana" }, { kana: "い", romaji: "i", type: "hiragana" },
            { kana: "う", romaji: "u", type: "hiragana" }, { kana: "え", romaji: "e", type: "hiragana" },
            { kana: "お", romaji: "o", type: "hiragana" },
            { kana: "か", romaji: "ka", type: "hiragana" }, { kana: "き", romaji: "ki", type: "hiragana" },
            { kana: "く", romaji: "ku", type: "hiragana" }, { kana: "け", romaji: "ke", type: "hiragana" },
            { kana: "こ", romaji: "ko", type: "hiragana" },
            { kana: "さ", romaji: "sa", type: "hiragana" }, { kana: "し", romaji: "shi", type: "hiragana" },
            { kana: "す", romaji: "su", type: "hiragana" }, { kana: "せ", romaji: "se", type: "hiragana" },
            { kana: "そ", romaji: "so", type: "hiragana" },
            { kana: "た", romaji: "ta", type: "hiragana" }, { kana: "ち", romaji: "chi", type: "hiragana" },
            { kana: "つ", romaji: "tsu", type: "hiragana" }, { kana: "て", romaji: "te", type: "hiragana" },
            { kana: "と", romaji: "to", type: "hiragana" },
            { kana: "な", romaji: "na", type: "hiragana" }, { kana: "に", romaji: "ni", type: "hiragana" },
            { kana: "ぬ", romaji: "nu", type: "hiragana" }, { kana: "ね", romaji: "ne", type: "hiragana" },
            { kana: "の", romaji: "no", type: "hiragana" },
            { kana: "は", romaji: "ha", type: "hiragana" }, { kana: "ひ", romaji: "hi", type: "hiragana" },
            { kana: "ふ", romaji: "fu", type: "hiragana" }, { kana: "へ", romaji: "he", type: "hiragana" },
            { kana: "ほ", romaji: "ho", type: "hiragana" },
            { kana: "ま", romaji: "ma", type: "hiragana" }, { kana: "み", romaji: "mi", type: "hiragana" },
            { kana: "む", romaji: "mu", type: "hiragana" }, { kana: "め", romaji: "me", type: "hiragana" },
            { kana: "も", romaji: "mo", type: "hiragana" },
            { kana: "や", romaji: "ya", type: "hiragana" }, { kana: "ゆ", romaji: "yu", type: "hiragana" },
            { kana: "よ", romaji: "yo", type: "hiragana" }, // Empty slots for "i" and "e" columns in "ya" row
            { kana: "ら", romaji: "ra", type: "hiragana" }, { kana: "り", romaji: "ri", type: "hiragana" },
            { kana: "る", romaji: "ru", type: "hiragana" }, { kana: "れ", romaji: "re", type: "hiragana" },
            { kana: "ろ", romaji: "ro", type: "hiragana" },
            { kana: "わ", romaji: "wa", type: "hiragana" }, { kana: "を", romaji: "wo", type: "hiragana" }, // Empty slots for "i", "u", "e" columns in "wa" row
            { kana: "ん", romaji: "n", type: "hiragana" }, // Special character 'n'
            // Add dakuten/handakuten and small characters if desired for a full chart
            // Example:
            // { kana: "が", romaji: "ga", type: "hiragana" }, { kana: "ぎ", romaji: "gi", type: "hiragana" }, { kana: "ぐ", romaji: "gu", type: "hiragana" }, { kana: "げ", romaji: "ge", type: "hiragana" }, { kana: "ご", romaji: "go", type: "hiragana" },
            // { kana: "ぱ", romaji: "pa", type: "hiragana" }, { kana: "ぴ", romaji: "pi", type: "hiragana" }, { kana: "ぷ", romaji: "pu", type: "hiragana" }, { kana: "ぺ", romaji: "pe", type: "hiragana" }, { kana: "ぽ", romaji: "po", type: "hiragana" },
            // { kana: "きゃ", romaji: "kya", type: "hiragana" }, { kana: "きゅ", romaji: "kyu", type: "hiragana" }, { kana: "きょ", romaji: "kyo", type: "hiragana" },


            // Katakana
            { kana: "ア", romaji: "a", type: "katakana" }, { kana: "イ", romaji: "i", type: "katakana" },
            { kana: "ウ", romaji: "u", type: "katakana" }, { kana: "エ", romaji: "e", type: "katakana" },
            { kana: "オ", romaji: "o", type: "katakana" },
            { kana: "カ", romaji: "ka", type: "katakana" }, { kana: "キ", romaji: "ki", type: "katakana" },
            { kana: "ク", romaji: "ku", type: "katakana" }, { kana: "ケ", romaji: "ke", type: "katakana" },
            { kana: "コ", romaji: "ko", type: "katakana" },
            { kana: "サ", romaji: "sa", type: "katakana" }, { kana: "シ", romaji: "shi", type: "katakana" },
            { kana: "ス", romaji: "su", type: "katakana" }, { kana: "セ", romaji: "se", type: "katakana" },
            { kana: "ソ", romaji: "so", type: "katakana" },
            { kana: "タ", romaji: "ta", type: "katakana" }, { kana: "チ", romaji: "chi", type: "katakana" },
            { kana: "ツ", romaji: "tsu", type: "katakana" }, { kana: "テ", romaji: "te", type: "katakana" },
            { kana: "ト", romaji: "to", type: "katakana" },
            { kana: "ナ", romaji: "na", type: "katakana" }, { kana: "ニ", romaji: "ni", type: "katakana" },
            { kana: "ヌ", romaji: "nu", type: "katakana" }, { kana: "ネ", romaji: "ne", type: "katakana" },
            { kana: "ノ", romaji: "no", type: "katakana" },
            { kana: "ハ", romaji: "ha", type: "katakana" }, { kana: "ヒ", romaji: "hi", type: "katakana" },
            { kana: "フ", romaji: "fu", type: "katakana" }, { kana: "ヘ", romaji: "he", type: "katakana" },
            { kana: "ホ", romaji: "ho", type: "katakana" },
            { kana: "マ", romaji: "ma", type: "katakana" }, { kana: "ミ", romaji: "mi", type: "katakana" },
            { kana: "ム", romaji: "mu", type: "katakana" }, { kana: "メ", romaji: "me", type: "katakana" },
            { kana: "モ", romaji: "mo", type: "katakana" },
            { kana: "ヤ", romaji: "ya", type: "katakana" }, { kana: "ユ", romaji: "yu", type: "katakana" },
            { kana: "ヨ", romaji: "yo", type: "katakana" },
            { kana: "ラ", romaji: "ra", type: "katakana" }, { kana: "リ", romaji: "ri", type: "katakana" },
            { kana: "ル", romaji: "ru", type: "katakana" }, { kana: "レ", romaji: "re", type: "katakana" },
            { kana: "ロ", romaji: "ro", type: "katakana" },
            { kana: "ワ", romaji: "wa", type: "katakana" }, { kana: "ヲ", romaji: "wo", type: "katakana" },
            { kana: "ン", romaji: "n", type: "katakana" },
        ];

        // This data is specifically for the quiz (random selection)
        // Corrected entries: Ensure 'kana' property always contains the Japanese character.
        const quizKanaData = [
            // Hiragana
            { kana: "あ", romaji: "a", type: "hiragana" }, { kana: "い", romaji: "i", type: "hiragana" },
            { kana: "う", romaji: "u", type: "hiragana" }, { kana: "え", romaji: "e", type: "hiragana" },
            { kana: "お", romaji: "o", type: "hiragana" },
            { kana: "か", romaji: "ka", type: "hiragana" }, { kana: "き", romaji: "ki", type: "hiragana" },
            { kana: "く", romaji: "ku", type: "hiragana" }, { kana: "け", romaji: "ke", type: "hiragana" },
            { kana: "こ", romaji: "ko", type: "hiragana" },
            { kana: "さ", romaji: "sa", type: "hiragana" }, { kana: "し", romaji: "shi", type: "hiragana" },
            { kana: "す", romaji: "su", type: "hiragana" }, { kana: "せ", romaji: "se", type: "hiragana" },
            { kana: "そ", romaji: "so", type: "hiragana" },
            { kana: "た", romaji: "ta", type: "hiragana" }, { kana: "ち", romaji: "chi", type: "hiragana" },
            { kana: "つ", romaji: "tsu", type: "hiragana" }, { kana: "て", romaji: "te", type: "hiragana" },
            { kana: "と", romaji: "to", type: "hiragana" },
            { kana: "な", romaji: "na", type: "hiragana" }, { kana: "に", romaji: "ni", type: "hiragana" },
            { kana: "ぬ", romaji: "nu", type: "hiragana" }, { kana: "ね", romaji: "ne", type: "hiragana" },
            { kana: "の", romaji: "no", type: "hiragana" },
            { kana: "は", romaji: "ha", type: "hiragana" }, { kana: "ひ", romaji: "hi", type: "hiragana" },
            { kana: "ふ", romaji: "fu", type: "hiragana" }, { kana: "へ", romaji: "he", type: "hiragana" },
            { kana: "ほ", romaji: "ho", type: "hiragana" },
            { kana: "ま", romaji: "ma", type: "hiragana" }, { kana: "み", romaji: "mi", type: "hiragana" },
            { kana: "む", romaji: "mu", type: "hiragana" }, { kana: "め", romaji: "me", type: "hiragana" },
            { kana: "も", romaji: "mo", type: "hiragana" },
            { kana: "や", romaji: "ya", type: "hiragana" }, { kana: "ゆ", romaji: "yu", type: "hiragana" },
            { kana: "よ", romaji: "yo", type: "hiragana" },
            { kana: "ら", romaji: "ra", type: "hiragana" }, { kana: "り", romaji: "ri", type: "hiragana" },
            { kana: "る", romaji: "ru", type: "hiragana" }, { kana: "れ", romaji: "re", type: "hiragana" },
            { kana: "ろ", romaji: "ro", type: "hiragana" },
            { kana: "わ", romaji: "wa", type: "hiragana" }, { kana: "を", romaji: "wo", type: "hiragana" },
            { kana: "ん", romaji: "n", type: "hiragana" },

            // Katakana
            { kana: "ア", romaji: "a", type: "katakana" }, { kana: "イ", romaji: "i", type: "katakana" },
            { kana: "ウ", romaji: "u", type: "katakana" }, { kana: "エ", romaji: "e", type: "katakana" },
            { kana: "オ", romaji: "o", type: "katakana" },
            { kana: "カ", romaji: "ka", type: "katakana" }, { kana: "キ", romaji: "ki", type: "katakana" },
            { kana: "ク", romaji: "ku", type: "katakana" }, { kana: "ケ", romaji: "ke", type: "katakana" },
            { kana: "コ", romaji: "ko", type: "katakana" },
            { kana: "サ", romaji: "sa", type: "katakana" }, { kana: "シ", romaji: "shi", type: "katakana" },
            { kana: "ス", romaji: "su", type: "katakana" }, { kana: "セ", romaji: "se", type: "katakana" },
            { kana: "ソ", romaji: "so", type: "katakana" },
            { kana: "タ", romaji: "ta", type: "katakana" }, { kana: "チ", romaji: "chi", type: "katakana" },
            { kana: "ツ", romaji: "tsu", type: "katakana" }, { kana: "テ", romaji: "te", type: "katakana" },
            { kana: "ト", romaji: "to", type: "katakana" },
            { kana: "ナ", romaji: "na", type: "katakana" }, { kana: "ニ", romaji: "ni", type: "katakana" },
            { kana: "ヌ", romaji: "nu", type: "katakana" }, { kana: "ネ", romaji: "ne", type: "katakana" },
            { kana: "ノ", romaji: "no", type: "katakana" },
            { kana: "ハ", romaji: "ha", type: "katakana" }, { kana: "ヒ", romaji: "hi", type: "katakana" },
            { kana: "フ", romaji: "fu", type: "katakana" }, { kana: "ヘ", romaji: "he", type: "katakana" },
            { kana: "ホ", romaji: "ho", type: "katakana" },
            { kana: "マ", romaji: "ma", type: "katakana" }, { kana: "ミ", romaji: "mi", type: "katakana" },
            { kana: "ム", romaji: "mu", type: "katakana" }, { kana: "メ", romaji: "me", type: "katakana" },
            { kana: "モ", romaji: "mo", type: "katakana" },
            { kana: "ヤ", romaji: "ya", type: "katakana" }, { kana: "ユ", romaji: "yu", type: "katakana" },
            { kana: "ヨ", romaji: "yo", type: "katakana" },
            { kana: "ラ", romaji: "ra", type: "katakana" }, { kana: "リ", romaji: "ri", type: "katakana" },
            { kana: "ル", romaji: "ru", type: "katakana" }, { kana: "レ", romaji: "re", type: "katakana" },
            { kana: "ロ", romaji: "ro", type: "katakana" },
            { kana: "ワ", romaji: "wa", type: "katakana" }, { kana: "ヲ", romaji: "wo", type: "katakana" },
            { kana: "ン", romaji: "n", type: "katakana" },
        ];


        // Structured data for chart display to follow Gojūon order with empty cells
        const hiraganaChartLayout = [
            [{ kana: "あ", romaji: "a" }, { kana: "い", romaji: "i" }, { kana: "う", romaji: "u" }, { kana: "え", romaji: "e" }, { kana: "お", romaji: "o" }],
            [{ kana: "か", romaji: "ka" }, { kana: "き", romaji: "ki" }, { kana: "く", romaji: "ku" }, { kana: "け", romaji: "ke" }, { kana: "こ", romaji: "ko" }],
            [{ kana: "さ", romaji: "sa" }, { kana: "し", romaji: "shi" }, { kana: "す", romaji: "su" }, { kana: "せ", romaji: "se" }, { kana: "そ", romaji: "so" }],
            [{ kana: "た", romaji: "ta" }, { kana: "ち", romaji: "chi" }, { kana: "つ", romaji: "tsu" }, { kana: "て", romaji: "te" }, { kana: "と", romaji: "to" }],
            [{ kana: "な", romaji: "na" }, { kana: "に", romaji: "ni" }, { kana: "ぬ", romaji: "nu" }, { kana: "ね", romaji: "ne" }, { kana: "の", romaji: "no" }],
            [{ kana: "は", romaji: "ha" }, { kana: "ひ", romaji: "hi" }, { kana: "ふ", romaji: "fu" }, { kana: "へ", romaji: "he" }, { kana: "ほ", romaji: "ho" }],
            [{ kana: "ま", romaji: "ma" }, { kana: "み", romaji: "mi" }, { kana: "む", romaji: "mu" }, { kana: "め", romaji: "me" }, { kana: "も", romaji: "mo" }],
            [{ kana: "や", romaji: "ya" }, null, { kana: "ゆ", romaji: "yu" }, null, { kana: "よ", romaji: "yo" }], // 'i' and 'e' columns are empty
            [{ kana: "ら", romaji: "ra" }, { kana: "り", romaji: "ri" }, { kana: "る", romaji: "ru" }, { kana: "れ", romaji: "re" }, { kana: "ろ", romaji: "ro" }],
            [{ kana: "わ", romaji: "wa" }, null, null, null, { kana: "を", romaji: "wo" }], // 'i', 'u', 'e' columns are empty
            [{ kana: "ん", romaji: "n" }, null, null, null, null] // 'n' stands alone
            // Add dakuten/handakuten and combinations here if needed for full chart
        ];

        const katakanaChartLayout = [
            [{ kana: "ア", romaji: "a" }, { kana: "イ", romaji: "i" }, { kana: "ウ", romaji: "u" }, { kana: "エ", romaji: "e" }, { kana: "オ", romaji: "o" }],
            [{ kana: "カ", romaji: "ka" }, { kana: "キ", romaji: "ki" }, { kana: "ク", romaji: "ku" }, { kana: "ケ", romaji: "ke" }, { kana: "コ", romaji: "ko" }],
            [{ kana: "サ", romaji: "sa" }, { kana: "シ", romaji: "shi" }, { kana: "ス", romaji: "su" }, { kana: "セ", romaji: "se" }, { kana: "ソ", romaji: "so" }],
            [{ kana: "タ", romaji: "ta" }, { kana: "チ", romaji: "chi" }, { kana: "ツ", romaji: "tsu" }, { kana: "テ", romaji: "te" }, { kana: "ト", romaji: "to" }],
            [{ kana: "ナ", romaji: "na" }, { kana: "ニ", romaji: "ni" }, { kana: "ヌ", romaji: "nu" }, { kana: "ネ", romaji: "ne" }, { kana: "ノ", romaji: "no" }],
            [{ kana: "ハ", romaji: "ha" }, { kana: "ヒ", romaji: "hi" }, { kana: "フ", romaji: "fu" }, { kana: "ヘ", romaji: "he" }, { kana: "ホ", romaji: "ho" }],
            [{ kana: "マ", romaji: "ma" }, { kana: "ミ", romaji: "mi" }, { kana: "ム", romaji: "mu" }, { kana: "メ", romaji: "me" }, { kana: "モ", romaji: "mo" }],
            [{ kana: "ヤ", romaji: "ya" }, null, { kana: "ユ", romaji: "yu" }, null, { kana: "ヨ", romaji: "yo" }],
            [{ kana: "ラ", romaji: "ra" }, { kana: "リ", romaji: "ri" }, { kana: "ル", romaji: "ru" }, { kana: "レ", romaji: "re" }, { kana: "ロ", romaji: "ro" }],
            [{ kana: "ワ", romaji: "wa" }, null, null, null, { kana: "ヲ", romaji: "wo" }],
            [{ kana: "ン", romaji: "n" }, null, null, null, null]
        ];


        // DOM elements
        const kanaDisplay = document.getElementById('kana-display');
        const romajiInput = document.getElementById('romaji-input');
        const checkButton = document.getElementById('check-button');
        const showAnswerButton = document.getElementById('show-answer-button');
        const answerDisplay = document.getElementById('answer-display');
        const quizContainer = document.getElementById('quiz-container');
        const messageBox = document.getElementById('message-box');
        const body = document.body;

        // Quiz type selection checkboxes
        const quizHiraganaCheckbox = document.getElementById('quiz-hiragana');
        const quizKatakanaCheckbox = document.getElementById('quiz-katakana');


        // Chart functionality DOM elements
        const showHiraganaChartButton = document.getElementById('show-hiragana-chart-button');
        const showKatakanaChartButton = document.getElementById('show-katakana-chart-button');
        const chartModalOverlay = document.getElementById('chart-modal-overlay');
        const chartModalContent = document.getElementById('chart-modal-content');
        const closeChartModalButton = document.getElementById('close-chart-modal-button');
        const chartTitle = document.getElementById('chart-title');
        const chartGrid = document.getElementById('chart-grid');
        const showRomajiChartCheckbox = document.getElementById('show-romaji-chart'); // New checkbox for Romaji in chart

        // Global variables to store current quiz state
        let currentKanaSet = []; // Stores the 3 randomly selected kana objects
        let correctStatus = [false, false, false]; // Tracks correctness for each of the 3 kana

        /**
         * Displays a temporary message box for user feedback.
         * @param {string} message - The message to display.
         * @param {boolean} isError - True for error message (red), false for success (green).
         */
        function showMessageBox(message, isError = false) {
            messageBox.textContent = message;
            messageBox.classList.remove('error');
            if (isError) {
                messageBox.classList.add('error');
            }
            messageBox.classList.add('show');
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, 2000); // Message disappears after 2 seconds
        }

        /**
         * Generates 3 random Hiragana or Katakana characters for the quiz,
         * based on the selected quiz types.
         */
        function generateKanaSet() {
            currentKanaSet = [];
            correctStatus = [false, false, false]; // Reset correctness for new set
            answerDisplay.textContent = ''; // Clear previously shown answers

            const includeHiragana = quizHiraganaCheckbox.checked;
            const includeKatakana = quizKatakanaCheckbox.checked;

            let availableKanaForQuiz = [];

            if (includeHiragana) {
                availableKanaForQuiz = availableKanaForQuiz.concat(quizKanaData.filter(item => item.type === 'hiragana'));
            }
            if (includeKatakana) {
                availableKanaForQuiz = availableKanaForQuiz.concat(quizKanaData.filter(item => item.type === 'katakana'));
            }

            // Fallback: If no type is selected, default to both to avoid an empty quiz
            if (availableKanaForQuiz.length === 0) {
                availableKanaForQuiz = quizKanaData;
                showMessageBox("No Kana type selected. Defaulting to both Hiragana and Katakana.", true);
                quizHiraganaCheckbox.checked = true; // Visually update checkboxes
                quizKatakanaCheckbox.checked = true;
            }

            // Ensure we have enough characters to pick 3 unique ones, if not, allow duplicates
            if (availableKanaForQuiz.length < 3) {
                 // Not enough unique characters for 3. Allow duplicates.
                 for (let i = 0; i < 3; i++) {
                    currentKanaSet.push(availableKanaForQuiz[Math.floor(Math.random() * availableKanaForQuiz.length)]);
                }
            } else {
                // Pick 3 unique random characters
                const shuffled = availableKanaForQuiz.sort(() => 0.5 - Math.random());
                currentKanaSet = shuffled.slice(0, 3);
            }

            displayKana();
        }

        /**
         * Displays the generated Kana characters on the page.
         */
        function displayKana() {
            kanaDisplay.innerHTML = ''; // Clear previous characters
            currentKanaSet.forEach((kanaObj, index) => {
                const charDiv = document.createElement('div');
                charDiv.id = `kana-${index}`;
                charDiv.className = `kana-char text-6xl font-bold p-4 border-2 border-gray-300 rounded-lg transition-all duration-200 ${correctStatus[index] ? 'bg-green-100 border-green-500 text-green-700' : 'bg-gray-50 text-gray-800'}`;
                charDiv.textContent = kanaObj.kana;
                kanaDisplay.appendChild(charDiv);
            });
            romajiInput.value = ''; // Clear input field
            romajiInput.focus(); // Focus input for quick entry
        }

        /**
         * Handles the shake animation for the screen.
         */
        function shakeScreen() {
            body.classList.add('shake-screen');
            setTimeout(() => {
                body.classList.remove('shake-screen');
            }, 300); // Duration of the shake animation
        }

        /**
         * Checks the user's Romaji input against the current Kana set.
         */
        function checkAnswer() {
            const inputRomaji = romajiInput.value.toLowerCase().trim();
            const romajiParts = inputRomaji.split(' ').filter(part => part !== ''); // Split input by space, filter empty

            let allCorrectInThisAttempt = true;
            let anyIncorrectInThisAttempt = false;

            currentKanaSet.forEach((kanaObj, index) => {
                const charDiv = document.getElementById(`kana-${index}`);
                charDiv.classList.remove('border-red-500', 'border-gray-300', 'border-green-500'); // Reset borders

                // Only check if this character hasn't been answered correctly yet
                if (!correctStatus[index]) {
                    // Check if there's an input part for this index and if it matches
                    if (romajiParts[index] && romajiParts[index] === kanaObj.romaji) {
                        correctStatus[index] = true;
                        charDiv.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                    } else {
                        allCorrectInThisAttempt = false;
                        anyIncorrectInThisAttempt = true;
                        charDiv.classList.add('border-red-500');
                    }
                } else {
                    // If already correct, ensure it stays green and doesn't affect `allCorrectInThisAttempt`
                    charDiv.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                }
            });

            if (anyIncorrectInThisAttempt) {
                shakeScreen();
                showMessageBox("Incorrect! Try again.", true);
            } else if (correctStatus.every(status => status === true)) {
                showMessageBox("All Correct! Generating new characters.", false);
                setTimeout(generateKanaSet, 1000); // Generate new set after a short delay
            } else if (!allCorrectInThisAttempt) {
                // This condition handles cases where some were correct, but not all, and no new incorrect ones were made
                // Or if the input was partially correct but not fully.
                showMessageBox("Keep going! Some answers are still incorrect.", true);
            }
        }

        /**
         * Reveals the correct Romaji answers for the current set of Kana.
         */
        function showAnswers() {
            const answers = currentKanaSet.map(kanaObj => kanaObj.romaji.toUpperCase()).join(' - ');
            answerDisplay.textContent = `Answers: ${answers}`;
            showMessageBox("Answers revealed!", false);
        }

        /**
         * Toggles the visibility of Romaji in the chart modal.
         */
        function toggleChartRomajiVisibility() {
            const romajiElements = chartGrid.querySelectorAll('.chart-romaji');
            if (showRomajiChartCheckbox.checked) {
                romajiElements.forEach(el => el.classList.remove('hidden'));
            } else {
                romajiElements.forEach(el => el.classList.add('hidden'));
            }
        }


        /**
         * Opens the chart modal and populates it with the specified kana type based on structured layout.
         * @param {string} type - 'hiragana' or 'katakana'
         */
        function openChartModal(type) {
            chartGrid.innerHTML = ''; // Clear previous chart content
            chartTitle.textContent = type === 'hiragana' ? 'Hiragana Chart' : 'Katakana Chart';

            const chartToDisplay = type === 'hiragana' ? hiraganaChartLayout : katakanaChartLayout;

            chartToDisplay.forEach(row => {
                row.forEach(kanaObj => {
                    const cell = document.createElement('div');
                    if (kanaObj) {
                        cell.className = 'chart-cell';
                        cell.innerHTML = `
                            <div class="chart-kana">${kanaObj.kana}</div>
                            <div class="chart-romaji">${kanaObj.romaji}</div>
                        `;
                    } else {
                        // For empty cells in the layout
                        cell.className = 'chart-cell empty';
                    }
                    chartGrid.appendChild(cell);
                });
            });

            // Apply current Romaji visibility setting when opening the modal
            toggleChartRomajiVisibility();

            chartModalOverlay.classList.add('show');
        }

        /**
         * Closes the chart modal.
         */
        function closeChartModal() {
            chartModalOverlay.classList.remove('show');
        }

        // Event Listeners
        checkButton.addEventListener('click', checkAnswer);
        showAnswerButton.addEventListener('click', showAnswers);
        romajiInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                checkAnswer();
            }
        });

        // Event listeners for quiz type checkboxes (trigger new quiz generation on change)
        quizHiraganaCheckbox.addEventListener('change', generateKanaSet);
        quizKatakanaCheckbox.addEventListener('change', generateKanaSet);

        // Event listeners for chart buttons
        showHiraganaChartButton.addEventListener('click', () => openChartModal('hiragana'));
        showKatakanaChartButton.addEventListener('click', () => openChartModal('katakana'));
        closeChartModalButton.addEventListener('click', closeChartModal);

        // Close modal when clicking outside the content
        chartModalOverlay.addEventListener('click', (event) => {
            if (event.target === chartModalOverlay) {
                closeChartModal();
            }
        });

        // New event listener for the show/hide Romaji checkbox in the chart modal
        showRomajiChartCheckbox.addEventListener('change', toggleChartRomajiVisibility);

        // Initialize the quiz when the page loads
        document.addEventListener('DOMContentLoaded', generateKanaSet);
    </script>
</body>
</html>
